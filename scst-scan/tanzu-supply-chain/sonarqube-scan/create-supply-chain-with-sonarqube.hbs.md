# Create a Supply Chain that performs a SonarQube Scan

This topic tells you how to create a Tanzu Supply Chain with SonarQube Scan.

Note: The SonarQube scan component currently only supports scanning maven projects.

## <a id="prerequisites"></a> Prerequisites

Tanzu Supply Chain packages

- [Tanzu Supply Chain packages](../../supply-chain/platform-engineering/how-to/installing-supply-chain/install-authoring-profile.hbs.md#tsc-packages)

Tanzu CLI plug-ins

- Tanzu Supplychain CLI plug-in, see [Tanzu Supply Chain CLI plug-ins](../../supply-chain/platform-engineering/how-to/install-the-cli.hbs.md).

## <a id="supply-chain-sonarqube"></a> Create a Supply Chain with SonarQube Scan

This section tells you how to create a supply chain with SonarQube Scan.

### <a id="sonarqube-scan"></a> Create a Supply Chain with SonarQube Scan Component

Create a Supply Chain with the SonarQube Scan component using the Tanzu Supplychain CLI plug-in:

1. Initialize Tanzu Supply Chain:

  ```console
  tanzu supplychain init --group <group-name>
  ```

  Example output:

  ```console
  $ tanzu supplychain init --group example.com
  Initializing group example.com
  Creating directory structure
  ├─ supplychains/
  ├─ components/
  ├─ pipelines/
  ├─ tasks/
  └─ config.yaml

  Writing group configuration to config.yaml
  ```

1. Generate Supply Chain:

  ```console
  tanzu supplychain generate --kind <name-of-supply-chain> \
  --description <description-for-supply-chain> \
  --component source-git-provider-1.0.0 \
  --component sonarqube-sast-scan-1.0.0
  ```

  Example output:

  ```console
  $ tanzu supplychain generate --kind SonarQubeSC \
    --description SonarQube \
    --component source-git-provider-1.0.0 \
    --component sonarqube-sast-scan-1.0.0

  ✓ Successfully fetched all component dependencies
  Created file supplychains/sonarqubesc.yaml
  Created file components/sonarqube-sast-scan-1.0.0.yaml
  Created file components/source-git-provider-1.0.0.yaml
  Created file pipelines/sonarqube-sast-scan.yaml
  Created file pipelines/source-git-provider.yaml
  Created file tasks/fetch-tgz-content-oci.yaml
  Created file tasks/sonarqube-maven-scan.yaml
  Created file tasks/source-git-check.yaml
  Created file tasks/source-git-clone.yaml
  Created file tasks/store-content-oci.yaml
  ```

### <a id="apply-supply-chain"></a> Apply Supply Chain

Generating the supply chain created the following directory structure:

  ```console
  ├─ supplychains/
  ├─ components/
  ├─ pipelines/
  ├─ tasks/
  ```

Apply these directories to the DEV-NAMESPACE where the workload will be run.

```console
kubectl apply -R -f components -f supplychains -f tasks -f pipelines -n DEV-NAMESPACE
```

Where  `DEV-NAMESPACE` is the same namespace where the workload will be.

## <a id="customize-sonarqube-task"></a> Customize SonarQube Scan Task

This section describes how to customize a SonarQube scan task to run on a different image.

The default image that the SonarQube scan task runs on is a mirror of the maven:3.9.6 image.
If this maven version is not compatible with your project to perform the SonarQube scan, you can customize the task to use
your own image with the maven version you need.

1. Edit the following line in the `tasks/sonarqube-maven-scan.yaml` previously generated by the Tanzu supplychain CLI:

    ```yaml
    apiVersion: tekton.dev/v1
    kind: Task
    metadata:
    name: sonarqube-maven-scan
    namespace: sonarqube-catalog
    spec:
    ...
      steps:
        - computeResources: {}
          ...
          # change this image field to point to your image
          image: registry.tanzu.vmware.com/tanzu-application-platform/tap-packages@sha256:a263660b3f2d89af528c9344856121ec26d21e97f09c3f70bf823a3ae5d9c8b1
          name: scan
    ...
    ```

1. Apply the custom task:

    ```console
    kubectl apply -f tasks/sonarqube-maven-scan.yaml -n DEV-NAMESPACE
    ```
